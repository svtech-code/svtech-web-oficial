---
import FormButton from './ui/FormButton.astro';
import FormInput from './ui/FormInput.astro';
import FormTextarea from './ui/FormTextarea.astro';
import Modal from './Modal.astro';
---

<article class="flex w-full flex-col items-center justify-center gap-4 px-4 md:px-0 lg:w-1/2">
  <div
    class="relative h-full w-full max-w-[500px] rounded-2xl border border-primary p-5 shadow-xs shadow-primary"
  >
    <header class="pb-8">
      <h3 class="text-2xl font-medium text-primary">Envíanos tu mensaje</h3>
    </header>

    <form id="contact-form" class="relative flex flex-col gap-6">
      <div class="flex flex-col gap-5">
        <div class="flex flex-col gap-5 md:flex-row md:gap-2">
          <FormInput
            id="name"
            name="name"
            label="Nombres"
            required={true}
            class="w-full md:w-3/5"
          />
          <FormInput
            id="phone"
            name="phone"
            label="Teléfono"
            type="tel"
            required={false}
            class="w-full md:w-2/5"
          />
        </div>

        <FormInput id="email" name="email" label="Email" type="email" required={true} />

        <FormTextarea id="message" name="message" label="Mensaje" required={true} />
      </div>

      <footer class="flex w-full flex-col items-center justify-center gap-8">
        <!-- Widget de Turnstile -->
        <div id="turnstile-widget" class="flex items-center justify-center"></div>

        <FormButton
          id="submit-btn"
          type="submit"
          class="w-full max-w-[250px]"
          text="Enviar mensaje"
        />
      </footer>
    </form>
  </div>
</article>

<Modal />

<script>
  import { ContactFormManager } from '../lib/contact-form-manager';
  import { LazyObserver } from '../lib/lazy-observer';

  document.addEventListener('astro:page-load', () => {
    // Inicializar formulario de contacto con lazy loading
    LazyObserver.create('#contact-form', () => void new ContactFormManager('#contact-form'), {
      preset: 'form',
    });
  });
</script>
