---
import Layout from 'layouts/Layout.astro';
import Hero from 'sections/Hero.astro';
import Service from 'sections/Service.astro';
import Why from 'sections/Why.astro';
import Customer from 'sections/Customer.astro';
import Contact from 'sections/Contact.astro';

const title = 'Sv Tech';

export const prerender = true;
---

<Layout title={title}>
  <Hero />
  <Service />
  <Why />
  <Customer />
  <Contact />
</Layout>

<!-- ✅ LAZY LOAD Customer JavaScript usando Intersection Observer -->
<script>
  document.addEventListener('astro:page-load', () => {
    const customerSection = document.getElementById('customers');
    
    if (customerSection && !customerSection.dataset.initialized) {
      // ✅ Usar Intersection Observer para carga lazy real
      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            // ✅ Marcar como inicializado
            customerSection.dataset.initialized = 'true';
            
            // ✅ Importar dinámicamente el módulo del carrusel
            import('../lib/customer-carousel.ts').then((module) => {
              module.CustomerCarousel.initialize('#customers');
            });
            
            // ✅ Dejar de observar una vez inicializado
            observer.unobserve(customerSection);
          }
        });
      }, {
        rootMargin: '50px' // Cargar cuando esté 50px antes de ser visible
      });
      
      observer.observe(customerSection);
    }
  });
</script>
